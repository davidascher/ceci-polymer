<polymer-element>
  <template>
    <style>
      app-paypal-donation .button {
        font-family: "FiraSans", sans-serif;
        cursor: pointer;
        position: relative;
        text-decoration: none;
        outline: none;
        border-top: 1px solid rgba(255,255,255,.3);
        border-bottom: 2px solid rgba(0,0,0,.2);
        background-color: #4DB227;
        text-align: center;
        display: block;
        padding-top: 5px;
        padding-bottom: 3px;
        text-overflow: ellipsis;
        overflow: hidden;
        border-radius: 0.2rem;
        font-weight: 600;
        font-size: 1.8rem;
        line-height: 3.8rem;
        color: #ffffff;
        width: 100%;
        margin: 0;
        margin-bottom: 5px;
      }
      
      app-paypal-donation button {
        border: none;
      }
      
      app-paypal-donation h1 {
        margin-bottom: 10px;
      }
      
      app-paypal-donation p.logos {
        text-align: center;
        font-size: 13px;
        padding-bottom: 20px;
        padding-top: 20px;
        color: #AAA;
      }
      
      app-paypal-donation p.logos span {
        color: #666;
      }
      
      app-paypal-donation p.logos img {
        max-width: 95%;  
      }
    </style>
    <div>
       <h1 id="donationAsk">I'm going to donate</h1>

       <h2>Donation Amount: <span></span></h2>

      <!-- Sandbox URL https://www.sandbox.paypal.com/cgi-bin/webscr -->
      <!-- Live URL https://www.paypal.com/cgi-bin/webscr -->
      <form id="paypal_donation_form" method="post" action="https://www.paypal.com/cgi-bin/webscr">
        <!-- PayPal bits -->
        <input type="hidden" name="amount" id="pp_amount" value="" />
        <input type="hidden" name="business" id="pp_business" value="" />
        <input type="hidden" name="currency_code" id="pp_currency_code" value=""
        />
        <input type="hidden" name="item_name" id="fundrasingCampaignName" value="Donation from AppMaker App"
        />
        <input type="hidden" name="no_shipping" value="1" />
        <input type="hidden" name="rm" value="1" />
        <input type="hidden" name="cmd" value="_donations" />
        <!-- TODO - could switch between donation and payments -->
        <input type="hidden" name="return" value="" />
        <!-- Return url is the current app url with query param to tell success
        -->
        <div class="button-wrapper">
          <button class="button" value=""></button>
          <button class="button" value=""></button>
          <button class="button" value=""></button>
        </div>
        <button class="button" id="buttonOwnAmount" value="0">Choose my own amount</button>
      </form>
      <p class="logos">
        <img src="{{ASSET_HOST}}/assets/images/paypal-logo.jpg" />
        <br />Donating to PayPal account run by
        <br /><span id="pp_account_email"></span>

      </p>
    </div>
  </template>
  <script>
    Polymer("paypal-donation", {
      ready: function () {
        this.ceci({
          broadcasts: ["donationSuccess"],
          defaultBroadcasts: ["donationSuccess"],
          defaultListeners: [],
          editable: {
            yourPayPalEmailAddress: {
              type: "text",
              description: "You can get this from your PayPal account",
              postset: function (v) {
                this.querySelector("#pp_business").value = v;
                this.querySelector("#pp_account_email").innerHTML = v;
              }
            },
            currency: {
              options: GBP,USD,CHF,CAD,
              type: "select",
              description: "Pick your preferred donation currency.",
              postset: function (v) {
                this.buildMenu(this.donationAmounts);
                this.querySelector("#pp_currency_code").value = v;
              }
            },
            donationAmounts: {
              type: "multiple",
              description: "Donation Amounts",
              postset: function (v) {
                this.buildMenu(v);
              }
            },
            donateMessage: {
              type: "text",
              description: "Set you own message asking for donations",
              postset: function (v) {
                this.querySelector("#donationAsk").innerHTML = v;
              }
            },
            showOwnAmountButton: {
              title: "Add 'Choose own amount' button",
              type: "boolean",
              description: "Switchs on an optional button",
              postset: function (v){
                var item = this.querySelector("#buttonOwnAmount");
                if (v === "true") {
                  item.setAttribute("style", "display:block;");
                }
                else {
                  item.setAttribute("style", "display:none;");
                }
              }
            },
            nameYourFundraisingCampaign: {
              type: "text",
              description: "This tells the organisation who raised the funds",
              postset: function (v) {
                this.querySelector("#fundrasingCampaignName").value = "AppMaker donation from " + v;
              }
            },
            usePaypalSandbox: {
              title: "Use Paypal Sandbox",
              type: "boolean",
              description: "",
              postset: function (v){
                var appForm = this.querySelector("#paypal_donation_form");
                if (v === "true") {
                  appForm.setAttribute('action', 'https://www.sandbox.paypal.com/cgi-bin/webscr');
                } else {
                  appForm.setAttribute('action', 'https://www.paypal.com/cgi-bin/webscr');
                }
              }
            },
          },
          listeners: {
            sendYourOwnDonationAmount: function (val) {
              val = parseInt(val);
              if (val > 0) {
                this.setAmount(val);
              }
            }
            submit: function () {
              this.querySelector('#paypal_donation_form').submit();
            }
          },
          friends: [""],
          thumbnail: "<img src="{{ASSET_HOST}}/assets/images/thumbnails/app-paypal-donate.png" />",
          description: "Add your own PayPal donation buttons, and start raising funds.",
          tags: ["paypal-donation.html"]
        });
      },
      
    });
  </script>
</polymer-element>